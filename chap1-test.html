<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­å¤§é¸æ“‡æ¬Šæ•™å®¤éš¨å ‚æ¸¬é©—</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- html2canvas for saving as image -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@700;900&display=swap');
        
        body { 
            background-color: #f4f4f2; 
            font-family: 'Noto Serif TC', serif; 
            margin: 0; 
            padding: 0; 
            min-height: 100vh; 
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }

        /* è­‰æ›¸å¤–æ¡†æ¶ï¼šå›ºå®šæ¨™æº– A4 æ¯”ä¾‹ 700x990 */
        .certificate-outer {
            padding: 0;
            background: #ffffff;
            box-shadow: 0 40px 100px rgba(0,0,0,0.12);
            border-radius: 2px;
            width: 700px;
            height: 990px;
            margin: 0 auto;
            position: relative;
            box-sizing: border-box;
            display: block;
            flex-shrink: 0;
        }
        
        /* æ¨¡æ“¬é«˜ç´šäºéº»ç´™å¼µè³ªæ„Ÿ */
        .certificate-container {
            background-color: #fdf8f1; 
            background-image: 
                repeating-linear-gradient(rgba(0,0,0,0.01) 0px, rgba(0,0,0,0.01) 1px, transparent 1px, transparent 3px),
                repeating-linear-gradient(90deg, rgba(0,0,0,0.01) 0px, rgba(0,0,0,0.01) 1px, transparent 1px, transparent 3px);
            border: 3.5px solid #a37b45;
            position: relative;
            overflow: hidden;
            width: 100%;
            height: 100%;
            box-sizing: border-box;
        }

        /* Joption æµ®æ°´å° */
        .watermark-overlay {
            position: absolute;
            inset: 0;
            z-index: 1;
            pointer-events: none;
            opacity: 0.04;
            background-image: url("data:image/svg+xml,%3Csvg width='160' height='80' viewBox='0 0 160 80' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='50%25' y='50%25' font-family='Arial, sans-serif' font-weight='900' font-size='12' fill='%23a37b45' text-anchor='middle' dominant-baseline='middle' transform='rotate(-25 80 40)'%3EJOPTION%3C/text%3E%3C/svg%3E");
            background-repeat: repeat;
        }

        .certificate-inner-border {
            border: 1px solid #dcd0b9;
            margin: 14px;
            height: calc(100% - 28px);
            position: relative;
            z-index: 2;
            box-sizing: border-box;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .no-wrap { white-space: nowrap; }

        /* æ‰‹æ©Ÿç«¯é è¦½ç¸®æ”¾èˆ‡é–“è·å„ªåŒ– */
        @media screen and (max-width: 768px) {
            .certificate-preview-scroll {
                width: 100%;
                overflow-x: auto;
                padding: 10px 0;
                display: flex;
                justify-content: flex-start;
                -webkit-overflow-scrolling: touch;
            }
            .certificate-outer {
                transform: scale(0.46); 
                transform-origin: top left;
                margin-left: calc(50vw - 161px); 
                margin-bottom: -550px; 
            }
        }

        /* å„²å­˜é è¦½æ¨¡æ…‹æ¡† */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            backdrop-filter: blur(8px);
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .btn-ghibli {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-radius: 99px;
            font-family: 'Noto Serif TC', serif;
        }
        .btn-ghibli:active { transform: scale(0.95); }
        
        .saveable-image {
            max-width: 100%;
            height: auto;
            display: block;
            user-select: auto !important;
            -webkit-user-select: auto !important;
            pointer-events: auto !important;
        }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        const CONFIG = {
            formActionUrl: "https://docs.google.com/forms/d/e/1FAIpQLSeoBO2Dumc6wTJ32dvoMhe-cfcaBh46DOWCb4EUl9XDPMvLmw/formResponse",
            nameEntryId: "entry.763113619",
            scoreEntryId: "entry.236333802",
            emailEntryId: "emailAddress", 
            SHEET_CSV_URL: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSVeIf30C4q_dI4RAoaNHjItk0F35QdtIvizSyJWbbNfnVxhYj-NyWocq67QknUEFr1_0oBvgJntMbi/pub?output=csv" 
        };

        const Trophy = () => (<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="inline mr-2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>);
        const Home = () => (<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="inline mr-2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="9 22 9 12 15 12 15 22"/></svg>);
        const Download = () => (<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="inline mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>);
        const Loader = ({ className }) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`animate-spin ${className}`}><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="4.93" y1="4.93" x2="7.76" y2="7.76"/><line x1="16.24" y1="16.24" x2="19.07" y2="19.07"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/><line x1="4.93" y1="19.07" x2="7.76" y2="16.24"/><line x1="16.24" y1="7.76" x2="19.07" y2="4.93"/></svg>);
        const X = () => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>);
        const ArrowDown = () => (<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="inline ml-1"><path d="m6 9 6 6 6-6"/></svg>);
        const ArrowUp = () => (<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="inline ml-1"><path d="m18 15-6-6-6 6"/></svg>);

        function App() {
            const [view, setView] = useState('home');
            const [playerName, setPlayerName] = useState('');
            const [playerEmail, setPlayerEmail] = useState('');
            const [currentQuestions, setCurrentQuestions] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [leaderboard, setLeaderboard] = useState([]);
            const [isLoadingLeaderboard, setIsLoadingLeaderboard] = useState(false);
            const [errorMessage, setErrorMessage] = useState('');
            const [quizFeedback, setQuizFeedback] = useState('');
            const [feedbackKey, setFeedbackKey] = useState(0); 
            const [failedThisQuestion, setFailedThisQuestion] = useState(false);
            const [isSaving, setIsSaving] = useState(false);
            const [savedImageUrl, setSavedImageUrl] = useState(null);
            
            const [sortConfig, setSortConfig] = useState({ field: 'score', direction: 'desc' });

            const formRef = useRef(null);
            const certificateRef = useRef(null);

            const getRankInfo = (s) => {
                if (s === 100) return { title: "æ¬Šåˆ©é‡‘ä¹‹ç¥", icon: "ğŸŸ£ğŸ‘‘", color: "text-purple-600" };
                if (s >= 90) return { title: "ç­–ç•¥æŒ‡æ®å®˜", icon: "â™Ÿï¸", color: "text-stone-900" };
                if (s >= 80) return { title: "è³£æ–¹æ“ç›¤æ‰‹", icon: "ğŸ“Š", color: "text-stone-800" };
                if (s >= 60) return { title: "æ¬Šåˆ©é‡‘å­¸å¾’", icon: "ğŸ’°", color: "text-orange-800" };
                return { title: "é¸æ“‡æ¬Šå°ç™½", icon: "â“", color: "text-stone-400" };
            };

            const parseCSV = (text) => {
                const lines = text.split(/\r?\n/).filter(line => line.trim() !== "");
                if (lines.length < 2) return [];
                const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
                let nameIdx = headers.findIndex(h => h.includes("å§“å") || h.includes("åç¨±"));
                let scoreIdx = headers.findIndex(h => h.includes("åˆ†æ•¸") || h.includes("æˆç¸¾"));
                if (nameIdx === -1) nameIdx = 2; if (scoreIdx === -1) scoreIdx = 3;
                
                return lines.slice(1).map(line => {
                    const cols = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    const cleanCols = cols.map(c => c.replace(/^"|"$/g, '').trim());
                    const rawTimestamp = cleanCols[0] || '';
                    const dateMatch = rawTimestamp.match(/\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}/);
                    const dateDisplay = dateMatch ? dateMatch[0] : rawTimestamp.split(' ')[0];
                    return { 
                        name: cleanCols[nameIdx] || "åŒ¿åç©å®¶", 
                        score: parseInt(cleanCols[scoreIdx]) || 0, 
                        date: dateDisplay,
                        timestamp: new Date(rawTimestamp.replace('ä¸‹åˆ', 'PM').replace('ä¸Šåˆ', 'AM')).getTime() || 0
                    };
                }).filter(item => item.name && !item.name.includes("å§“å"));
            };

            const fetchLeaderboard = async () => {
                setIsLoadingLeaderboard(true);
                try {
                    const response = await fetch(`${CONFIG.SHEET_CSV_URL}&t=${Date.now()}`);
                    const text = await response.text();
                    setLeaderboard(parseCSV(text));
                } catch (e) { console.error(e); } finally { setIsLoadingLeaderboard(false); }
            };

            const sortedLeaderboard = useMemo(() => {
                const items = [...leaderboard];
                items.sort((a, b) => {
                    let valA = a[sortConfig.field];
                    let valB = b[sortConfig.field];
                    if (sortConfig.field === 'score' || sortConfig.field === 'timestamp') {
                        return sortConfig.direction === 'desc' ? valB - valA : valA - valB;
                    }
                    return sortConfig.direction === 'desc' ? String(valB).localeCompare(String(valA)) : String(valA).localeCompare(String(valB));
                });
                return items;
            }, [leaderboard, sortConfig]);

            const handleSort = (field) => {
                setSortConfig(prev => ({ field, direction: prev.field === field && prev.direction === 'desc' ? 'asc' : 'desc' }));
            };

            const startQuiz = () => {
                if (!playerName.trim()) return setErrorMessage("è«‹è¼¸å…¥æ‚¨çš„å§“å");
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!playerEmail.trim() || !emailRegex.test(playerEmail)) return setErrorMessage("è«‹è¼¸å…¥æ­£ç¢ºçš„é›»å­ä¿¡ç®±æ ¼å¼");

                setErrorMessage('');
                const qBank = [
                    // åŸæœ‰é¡Œç›®
                    { q: "é—œæ–¼é¸æ“‡æ¬Šï¼Œè²·æ–¹ï¼ˆBuyï¼‰èˆ‡è³£æ–¹ï¼ˆSellï¼‰çš„é¢¨éšªæ•˜è¿°ä½•è€…æ­£ç¢ºï¼Ÿ", a: ["è²·æ–¹é¢¨éšªæœ‰é™ï¼Œè³£æ–¹é¢¨éšªç„¡é™", "è³£æ–¹é¢¨éšªæœ‰é™ï¼Œè²·æ–¹é¢¨éšªç„¡é™", "å…©è€…é¢¨éšªçš†ç‚ºç„¡é™", "å…©è€…é¢¨éšªçš†ç‚ºæœ‰é™"], correct: 0 },
                    { q: "ç•¶ä½ é æœŸæœªä¾†è¡Œæƒ…æœƒã€Œå¤§æ¼²ã€ï¼Œæœ€é©åˆçš„ç°¡å–®ç­–ç•¥æ˜¯ï¼Ÿ", a: ["Buy Put", "Sell Call", "Buy Call", "Sell Put"], correct: 2 },
                    { q: "å°æŒ‡é¸æ“‡æ¬Šä¸­ï¼Œæ‰€è¬‚çš„ã€Œé€±é¸æ“‡æ¬Šã€é€šå¸¸åœ¨æ¯é€±å¹¾é€²è¡Œçµç®—ï¼Ÿ", a: ["é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››"], correct: 2 },
                    { q: "æ­å¤§å¸¸æåˆ°çš„ã€Œè³£å‡ºå‹’å¼ç­–ç•¥ã€æ˜¯æŒ‡åŒæ™‚åšä»€éº¼å‹•ä½œï¼Ÿ", a: ["è²·é€² Callï¼Œè²·é€² Put", "è³£å‡ºä¸åŒå±¥ç´„åƒ¹çš„ Call èˆ‡ Put", "è³£å‡º Callï¼Œè²·é€² Put", "è²·é€² Callï¼Œè³£å‡º Put"], correct: 1 },
                    { q: "åœ¨æœŸæ¬Šäº¤æ˜“ä¸­ï¼Œã€Œæ™‚é–“åƒ¹å€¼ã€çš„æµé€ï¼ˆThetaï¼‰å°å“ªä¸€æ–¹æœ€æœ‰åˆ©ï¼Ÿ", a: ["è²·æ–¹", "è³£æ–¹", "è­‰åˆ¸å•†", "æœŸäº¤æ‰€"], correct: 1 },
                    // æ–°å¢ 50 é¡Œ
                    { q: "é¸æ“‡æ¬Šæ˜¯ä»¥ä¸‹å“ªä¸€ç¨®é‡‘èå·¥å…·ï¼Ÿ", a: ["è‚¡æ¯è‚¡ç¥¨", "è¡ç”Ÿæ€§å•†å“", "å‚µåˆ¸", "è²¨å¹£"], correct: 1 },
                    { q: "é¸æ“‡æ¬Šçš„è²·æ–¹æ“æœ‰ä»€éº¼ï¼Ÿ", a: ["ä¸€ç¨®ç¾©å‹™", "ä¸€ç¨®æ¬Šåˆ©", "ç„¡ä»»ä½•æ¬Šåˆ©", "ä¸€ç¨®è‚¡ç¥¨"], correct: 1 },
                    { q: "è³£æ–¹è³£å‡ºé¸æ“‡æ¬Šå¾Œæœ€ä¸»è¦çš„ç¾©å‹™æ˜¯ä»€éº¼ï¼Ÿ", a: ["å¿…é ˆè³¼è²·æ¨™çš„", "å¿…é ˆå±¥ç´„", "å¯èƒ½å¿…é ˆå±¥ç´„", "ä¸éœ€è² ä»»ä½•è²¬ä»»"], correct: 2 },
                    { q: "è²·æ–¹ä»˜çµ¦è³£æ–¹çš„è²»ç”¨ç¨±ç‚ºï¼Ÿ", a: ["ä¿è­‰é‡‘", "æœŸè²¨è²»", "æ¬Šåˆ©é‡‘", "äº¤æ˜“ç¨…"], correct: 2 },
                    { q: "çœ‹æ¼²é¸æ“‡æ¬Šè‹±æ–‡ç¸®å¯«æ˜¯ï¼Ÿ", a: ["PUT", "CALL", "STOP", "LIMIT"], correct: 1 },
                    { q: "çœ‹è·Œé¸æ“‡æ¬Šè‹±æ–‡ç¸®å¯«æ˜¯ï¼Ÿ", a: ["CALL", "FUTURE", "PUT", "OPTION"], correct: 2 },
                    { q: "è‹¥é¸æ“‡æ¬Šåˆ°æœŸå¾Œæ²’æœ‰åƒ¹å€¼ï¼Œè²·æ–¹æœƒï¼š", a: ["å±¥ç´„", "ä¸å±¥ç´„", "è³£å‡ºè‚¡ç¥¨", "è³£å‡ºé¸æ“‡æ¬Š"], correct: 1 },
                    { q: "é¸æ“‡æ¬Šåˆ°æœŸå¾Œï¼Œè²·æ–¹é¸æ“‡ä¸å±¥ç´„ï¼Œä»£è¡¨ä»€éº¼ï¼Ÿ", a: ["è²·æ–¹æå¤±å…¨éƒ¨æ¬Šåˆ©é‡‘", "è²·æ–¹éœ€æ”¯ä»˜ä¿è­‰é‡‘", "è²·æ–¹å¿…é ˆåŸ·è¡Œäº¤æ˜“", "è²·æ–¹å¿…é ˆè£œäº¤å·®åƒ¹"], correct: 0 },
                    { q: "å¦‚æœä½ è²·äº†çœ‹æ¼²é¸æ“‡æ¬Šï¼Œä½ é æœŸçš„å¸‚å ´æ–¹å‘æ˜¯ï¼Ÿ", a: ["ä¸‹è·Œ", "æŒå¹³", "ä¸ç¢ºå®š", "ä¸Šæ¼²"], correct: 3 },
                    { q: "å¦‚æœä»¥ å°æŒ‡æœŸæŒ‡æ•¸ (TX) ä½œç‚ºæ¨™çš„è³‡ç”¢ï¼Œåœ¨é¸æ“‡æ¬Šåˆ°æœŸå‰å°æŒ‡å¤§å¹…ä¸‹è·Œï¼Œå“ªä¸€æ–¹ç²åˆ©æœ‰æ©Ÿæœƒç¿»å€ï¼Ÿ", a: ["å°æŒ‡çœ‹æ¼² (Call) è²·æ–¹", "å°æŒ‡çœ‹è·Œ (Put) è²·æ–¹", "å°æŒ‡çœ‹æ¼² (Call) è³£æ–¹", "å°æŒ‡çœ‹è·Œ (Put) è³£æ–¹"], correct: 1 },
                    { q: "é¸æ“‡æ¬Šè²·æ–¹åˆ°æœŸå¯é¸æ“‡æ˜¯å¦å±¥ç´„ï¼Œé€™ä»£è¡¨è²·æ–¹æœ‰ï¼š", a: ["è²¬ä»»", "è² æ“”", "æ¬Šåˆ©", "ç¾©å‹™"], correct: 2 },
                    { q: "çœ‹æ¼²è²·æ–¹æœ€å¤§æå¤±æ˜¯ï¼Ÿ", a: ["ç„¡é™", "å…¬å¸è‚¡åƒ¹", "ä¿è­‰é‡‘", "æ¬Šåˆ©é‡‘"], correct: 3 },
                    { q: "çœ‹è·Œè²·æ–¹æœ€å¤§ç²åˆ©ç†è«–ä¸Šæ˜¯ï¼Ÿ", a: ["æ¨™çš„åˆ° 0", "æ¬Šåˆ©é‡‘", "æœªçŸ¥", "ç„¡æ³•è¨ˆç®—"], correct: 0 },
                    { q: "è²·æ–¹ä¸å±¥ç´„æœƒå°è‡´ï¼Ÿ", a: ["è²·æ–¹éœ€æ”¯ä»˜è‚¡ç¥¨", "è²·æ–¹æå¤±æ¬Šåˆ©é‡‘", "è²·æ–¹éœ€æ”¯ä»˜ä¿è­‰é‡‘", "è²·æ–¹éœ€æ”¯ä»˜é¡å¤–è²»ç”¨"], correct: 1 },
                    { q: "è²·æ–¹ä½¿ç”¨æ¬Šåˆ©å±¥ç´„æœƒç²å¾—ï¼Ÿ", a: ["è‚¡ç¥¨æˆ–ç¾é‡‘å·®é¡", "ä¿è­‰é‡‘", "è‚¡ç¥¨æœŸè²¨", "åˆ†ç´…"], correct: 0 },
                    { q: "å°æŒ‡é¸æ“‡æ¬Šè²·æ–¹å¦‚ä½•æå‰çµ‚æ­¢ï¼Ÿ", a: ["ä¸å¯ä»¥", "éœ€æå‰ç”³è«‹", "å¯ä»¥è³£å›å¹³å€‰", "å–æ±ºæ–¼å¸‚å ´"], correct: 2 },
                    { q: "è²·æ–¹çš„ç²åˆ©ä¾†æºä¸»è¦æ˜¯ï¼Ÿ", a: ["åƒ¹å·®", "ä¿è­‰é‡‘", "è‚¡ç¥¨è‚¡åˆ©", "æ¬Šåˆ©é‡‘æ”¶å…¥"], correct: 0 },
                    { q: "èˆ‡æ­·å²æ¯”è¼ƒï¼Œç›¸åŒåˆ°æœŸæ—¥ï¼Œæ¬Šåˆ©é‡‘è¶Šé«˜ä»£è¡¨ï¼Ÿ", a: ["æ²’æœ‰é¢¨éšª", "å¸‚å ´å¹³éœ", "äº¤æ˜“ç¨…", "å¸‚å ´æ³¢å‹•è¶Šå¤§"], correct: 3 },
                    { q: "è²·æ–¹è™§ææœ€å¤§å¯èƒ½ç™¼ç”Ÿæ–¼ï¼Ÿ", a: ["åˆ°æœŸåƒ¹å¤–", "å±¥ç´„åƒ¹å…§", "æ¨™çš„ä¸Šæ¼²", "ä¿è­‰é‡‘ä¸è¶³"], correct: 0 },
                    { q: "è²·æ–¹è‹¥é æœŸæœƒé«˜æ³¢å‹•æ‡‰è©²ï¼Ÿ", a: ["è³£é¸æ“‡æ¬Š", "è²·é¸æ“‡æ¬Š", "ä¸äº¤æ˜“", "è³¼è²·å‚µåˆ¸"], correct: 1 },
                    { q: "é¸æ“‡æ¬Šè³£æ–¹çš„ç¾©å‹™æ˜¯ï¼Ÿ", a: ["æ“æœ‰æ¬Šåˆ©", "é ˜å–è‚¡æ¯", "ä¿ç•™ç¾é‡‘", "æ‰¿æ“”å±¥ç´„é¢¨éšª"], correct: 3 },
                    { q: "è³£æ–¹æœ€å¤§ç²åˆ©ç‚ºï¼Ÿ", a: ["æ¬Šåˆ©é‡‘", "è‚¡åˆ©", "æ¨™çš„å‡å€¼", "åˆ©æ¯"], correct: 0 },
                    { q: "è³£æ–¹æœ€å¤§æå¤±æ˜¯ï¼Ÿ", a: ["æ¬Šåˆ©é‡‘", "ç†è«–ç„¡é™", "æ¨™çš„ä¸‹è·Œ", "ä¿è­‰é‡‘"], correct: 1 },
                    { q: "è³£å‡º Put çš„æœ€å¤§æå¤±ç‚ºï¼Ÿ", a: ["æ¨™çš„è·Œè‡³ 0", "æ¬Šåˆ©é‡‘", "å¸‚å ´å¹³ç©©", "ä¿è­‰é‡‘"], correct: 0 },
                    { q: "è³£æ–¹æ”¶åˆ°çš„è²»ç”¨æ˜¯ï¼Ÿ", a: ["åˆ©æ¯", "æ¬Šåˆ©é‡‘", "åˆ†ç´…", "ä¿è­‰é‡‘"], correct: 1 },
                    { q: "è³£æ–¹éœ€æº–å‚™ï¼Ÿ", a: ["æ¬Šåˆ©é‡‘", "åˆ©æ¯", "ä¿è­‰é‡‘", "å‚µåˆ¸"], correct: 2 },
                    { q: "è³£æ–¹åœ¨åˆ°æœŸï¼ŒæŒæœ‰å€‰ä½æ˜¯åœ¨åƒ¹å¤–å‰‡æœƒï¼Ÿ", a: ["è´å¾—æ•´ç­†æ¬Šåˆ©é‡‘", "å±¥ç´„", "è™§æ", "è£œäº¤ä¿è­‰é‡‘"], correct: 0 },
                    { q: "è³£æ–¹æ‰¿å—çš„é¢¨éšªå±¬æ–¼ï¼Ÿ", a: ["ç›ˆåˆ©æœ€å¤§", "ç„¡é™é¢¨éšª", "æœ‰é™é¢¨éšª", "ç„¡è²¬ä»»"], correct: 1 },
                    { q: "è³£æ–¹å¹³å€‰å¯ä»¥ï¼Ÿ", a: ["é™ä½é¢¨éšª", "å¢åŠ æ¬Šåˆ©é‡‘", "é ˜å–è‚¡æ¯", "å»¶é•·åˆ°æœŸ"], correct: 0 },
                    { q: "è³£æ–¹è‹¥é æœŸæ¨™çš„éœ‡ç›ªå°ï¼Œæ‡‰è©²ï¼Ÿ", a: ["è²·å…¥é¸æ“‡æ¬Š", "åšç©ºè‚¡ç¥¨", "è³£å‡ºé¸æ“‡æ¬Š", "ä¸äº¤æ˜“"], correct: 2 },
                    { q: "ç†è«–ä¸Šï¼Œé¸æ“‡æ¬Šè²·æ–¹çš„å‹ç‡é€šå¸¸ï¼Ÿ", a: ["å¤§æ–¼è³£æ–¹", "ç›¸ç­‰", "å°æ–¼è³£æ–¹", "ä¸ç¢ºå®š"], correct: 2 },
                    { q: "ç‚ºä»€éº¼é¸æ“‡æ¬Šè³£æ–¹ç†è«–ä¸Šå‹ç‡è¼ƒé«˜ï¼Ÿ", a: ["å› ç‚ºè³£æ–¹å¿…å®šèƒ½ç²åˆ©", "å› ç‚ºè³£æ–¹æ”¶åˆ°æ¬Šåˆ©é‡‘ä¸¦ä¸”å¤§å¤šåˆ°æœŸåƒ¹å¤–", "å› ç‚ºè³£æ–¹ç„¡é¢¨éšª", "å› ç‚ºè³£æ–¹å¯ä»¥ç„¡é™å¢é•·è‚¡ç¥¨"], correct: 1 },
                    { q: "è‹¥é¸æ“‡æ¬Šçš„å€‰ä½éƒ½åœ¨åƒ¹å¤–ï¼Œå‹ç‡å°èª°æœ‰åˆ©ï¼Ÿ", a: ["è³£æ–¹", "è²·æ–¹", "äº¤æ˜“å“¡", "å¸‚å ´"], correct: 0 },
                    { q: "åˆ°æœŸå€‰ä½åœ¨åƒ¹å…§ä»£è¡¨ï¼Ÿ", a: ["ç„¡åƒ¹å€¼", "å‹ç®—ä½", "æ³¢å‹•å¤§", "æœ‰åƒ¹å€¼"], correct: 3 },
                    { q: "ä¸‹åˆ—ä½•ç¨®æƒ…æ³è¡¨ç¤ºé¸æ“‡æ¬Šæ˜¯åƒ¹å…§ï¼ˆITMï¼‰ï¼Ÿ", a: ["Call çš„å±¥ç´„åƒ¹ä½æ–¼ç¾è²¨åƒ¹æ ¼", "Put çš„å±¥ç´„åƒ¹ä½æ–¼ç¾è²¨åƒ¹æ ¼", "Call çš„å±¥ç´„åƒ¹é«˜æ–¼ç¾è²¨åƒ¹æ ¼", "Put çš„å±¥ç´„åƒ¹ç­‰æ–¼ç¾è²¨åƒ¹æ ¼"], correct: 0 },
                    { q: "è²·æ–¹å¸¸è¦‹å¤±æ•—åŸå› æ˜¯ï¼Ÿ", a: ["è·å¾—è‚¡æ¯", "æ¨™çš„å‡å€¼", "æ™‚é–“åƒ¹å€¼æµå¤±", "é«˜å‹ç‡"], correct: 2 },
                    { q: "æ™‚é–“åƒ¹å€¼æ¸›å°‘å°è²·æ–¹æ˜¯ï¼Ÿ", a: ["æœ‰åˆ©", "ä¸­æ€§", "ä¸åˆ©", "ä¸å½±éŸ¿"], correct: 2 },
                    { q: "éš±æ³¢å‹•ç‡ä¸Šå‡é€šå¸¸æœƒï¼Ÿ", a: ["å¢åŠ é¸æ“‡æ¬Šåƒ¹å€¼", "æ¸›å°‘é¸æ“‡æ¬Šåƒ¹å€¼", "ä¸è®Š", "å–æ¶ˆ"], correct: 0 },
                    { q: "éš±æ³¢å‹•ç‡ä¸‹é™å°è²·æ–¹ï¼Ÿ", a: ["æœ‰åˆ©", "ä¸­æ€§", "ä¸åˆ©", "æ½›åœ¨ç›ˆåˆ©"], correct: 2 },
                    { q: "æŒæœ‰åƒ¹å¤–é¸æ“‡æ¬Šåˆ°æœŸï¼Œçµæœæ˜¯ï¼Ÿ", a: ["ç²åˆ©", "å…¨éƒ¨æ¬Šåˆ©é‡‘æå¤±", "å±¥ç´„", "æ’¤å–®"], correct: 1 },
                    { q: "çœ‹æ¼²é¸æ“‡æ¬Šæœ€è³ºéŒ¢æ™‚æ©Ÿæ˜¯ï¼Ÿ", a: ["æ¨™çš„å¤§è·Œ", "æ¨™çš„å¤§æ¼²", "ä¸å‹•", "éš¨æ©Ÿ"], correct: 1 },
                    { q: "çœ‹è·Œé¸æ“‡æ¬Šæœ€è³ºéŒ¢æ™‚æ©Ÿæ˜¯ï¼Ÿ", a: ["æ¨™çš„å¤§è·Œ", "æ¨™çš„å¤§æ¼²", "ä¸å‹•", "éš¨æ©Ÿ"], correct: 0 },
                    { q: "è³£æ–¹è¢«åŸ·è¡Œå±¥ç´„æ™‚ï¼Œä»£è¡¨è²·æ–¹ï¼Ÿ", a: ["å±¥ç´„", "ä¸å±¥ç´„", "æ”¾æ£„", "å–æ¶ˆ"], correct: 0 },
                    { q: "è²·æ–¹æ“æœ‰æ™‚é–“åƒ¹å€¼è¡°æ¸›çš„ä¸åˆ©å½±éŸ¿ç¨±ç‚ºï¼Ÿ", a: ["Delta", "Gamma", "Theta", "Vega"], correct: 2 },
                    { q: "Delta è¡¡é‡çš„æ˜¯ï¼Ÿ", a: ["æ™‚é–“åƒ¹å€¼", "åƒ¹æ ¼è®Šå‹•æ•æ„Ÿåº¦", "åˆ©ç‡", "æ³¢å‹•ç‡"], correct: 1 },
                    { q: "è²·æ–¹å¸Œæœ›æ™‚é–“è¡°æ¸›è¶Šï¼Ÿ", a: ["å¿«", "ç„¡æ‰€è¬‚", "æ…¢", "ä¸éœ€è€ƒæ…®"], correct: 2 },
                    { q: "è³£æ–¹å¸Œæœ›æ³¢å‹•ç‡è¶Šï¼Ÿ", a: ["é«˜", "ä½", "ä¸è®Š", "æ™‚é–“å¤§"], correct: 1 },
                    { q: "å¦‚æœä½ èªç‚ºå¸‚å ´å°‡å¤§å¹…æ³¢å‹•ï¼Œä½ æœƒï¼Ÿ", a: ["è³£é¸æ“‡æ¬Š", "æŒæœ‰ç¾é‡‘", "è²·é¸æ“‡æ¬Š", "è³¼è²·å‚µåˆ¸"], correct: 2 },
                    { q: "åœ¨é¸æ“‡æ¬Šåˆ°æœŸæ—¥ç•¶å¤©ï¼Œå¦‚æœæ¨™çš„åƒ¹æ ¼å¹¾ä¹æ²’è®Šå‹•ï¼Œå“ªä¸€æ–¹æœ€å¯èƒ½ç²å¾—å„ªå‹¢ï¼Ÿ", a: ["è³£æ–¹ä¿ç•™æ¬Šåˆ©é‡‘", "è²·æ–¹ç²åˆ©", "è³£æ–¹éœ€è£œè²¼å·®åƒ¹", "è²·æ–¹æ”¶è‚¡åˆ©"], correct: 0 },
                    { q: "è³£æ–¹é¢¨éšªç®¡ç†æœ€é‡è¦æ˜¯ï¼Ÿ", a: ["å¿½ç•¥", "å¹³å€‰æˆ–å°æ²–", "å¢åŠ åˆç´„", "æ”¾ä»»"], correct: 1 }
                ];
                
                // éš¨æ©Ÿé¸ 20 é¡Œ
                setCurrentQuestions([...qBank].sort(() => 0.5 - Math.random()).slice(0, 20));
                setCurrentIndex(0); setScore(0); setFailedThisQuestion(false); setView('quiz');
            };

            const handleAnswer = (idx) => {
                const isCorrect = idx === currentQuestions[currentIndex].correct;
                if (isCorrect) {
                    setQuizFeedback('');
                    // æ¯é¡Œ 5 åˆ† (20 é¡Œå…± 100 åˆ†)ï¼Œè‹¥è©²é¡Œæ›¾ç­”éŒ¯å‰‡è©²é¡Œä¸çµ¦åˆ†
                    const finalScoreForThisQuestion = failedThisQuestion ? 0 : 5;
                    const newScore = score + finalScoreForThisQuestion;
                    setScore(newScore);

                    if (currentIndex < 19) {
                        setCurrentIndex(currentIndex + 1);
                        setFailedThisQuestion(false);
                    } else {
                        setView('result');
                        setTimeout(() => { 
                            if (formRef.current) {
                                formRef.current.submit(); 
                                fetchLeaderboard(); 
                            } 
                        }, 800);
                    }
                } else {
                    setQuizFeedback('ç­”æ¡ˆéŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡ï¼');
                    setFeedbackKey(prev => prev + 1); 
                    setFailedThisQuestion(true);
                    if (typeof navigator !== 'undefined' && navigator.vibrate) {
                        navigator.vibrate(200);
                    }
                }
            };

            const saveAsImage = async () => {
                if (!certificateRef.current || isSaving) return;
                setIsSaving(true);
                setErrorMessage("");
                try {
                    window.scrollTo(0, 0);
                    const canvas = await html2canvas(certificateRef.current, {
                        scale: 3, 
                        useCORS: true,
                        allowTaint: true,
                        backgroundColor: "#fdf8f1",
                        logging: false
                    });
                    const dataUrl = canvas.toDataURL("image/png", 1.0);
                    setSavedImageUrl(dataUrl);
                    const link = document.createElement('a');
                    link.download = `çµæ¥­è­‰æ›¸_${playerName}.png`;
                    link.href = dataUrl;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } catch (err) { setErrorMessage("ç”Ÿæˆå¤±æ•—ï¼Œå»ºè­°æˆªåœ–å„²å­˜ã€‚"); } finally { setIsSaving(false); }
            };

            return (
                <div className="min-h-screen p-4 flex flex-col items-center justify-center relative bg-[#f4f4f2]">
                    <div style={{ display: 'none' }}>
                        <iframe name="hidden_iframe"></iframe>
                        <form ref={formRef} action={CONFIG.formActionUrl} method="POST" target="hidden_iframe">
                            <input type="hidden" name={CONFIG.nameEntryId} value={playerName} />
                            <input type="hidden" name={CONFIG.scoreEntryId} value={score} />
                            <input type="hidden" name={CONFIG.emailEntryId} value={playerEmail} />
                        </form>
                    </div>

                    <div className="relative w-full max-w-lg z-10 py-4">
                        
                        {view === 'home' && (
                            <div className="bg-white/90 backdrop-blur-md p-10 rounded-[30px] shadow-2xl border-4 border-white text-center fade-in">
                                <div className="mb-8">
                                    <img src="IPæ¨™ç±¤.jpg" alt="Logo" className="w-32 h-auto mx-auto border-4 border-white shadow-lg rounded-2xl" 
                                         onError={(e) => { e.target.onerror = null; e.target.src='https://www.google.com/s2/favicons?domain=joption.tw&sz=128'; }} />
                                </div>
                                <h1 className="text-3xl font-bold text-stone-900 mb-2 font-serif">æ­å¤§é¸æ“‡æ¬Šæ•™å®¤</h1>
                                <p className="text-stone-500 mb-10 italic">éš¨å ‚æ¸¬é©— â€” æ¸¬é©—ä½ çš„æœŸæ¬Šå¯¦åŠ›</p>
                                <div className="space-y-4 mb-8 text-left">
                                    <input type="text" placeholder="æ‚¨çš„å§“åï¼Œä¾‹å¦‚ï¼šæ­å¤§" className="w-full px-6 py-4 rounded-full border-2 border-stone-100 focus:border-amber-400 focus:outline-none text-lg bg-stone-50/50" value={playerName} onChange={(e) => setPlayerName(e.target.value)} />
                                    <input type="email" placeholder="é›»å­ä¿¡ç®± (å¿…å¡«)" className="w-full px-6 py-4 rounded-full border-2 border-stone-100 focus:border-amber-400 focus:outline-none text-lg bg-stone-50/50" value={playerEmail} onChange={(e) => setPlayerEmail(e.target.value)} />
                                    {errorMessage && <p className="text-red-500 text-sm font-bold text-center mt-2">{errorMessage}</p>}
                                </div>
                                <div className="space-y-3 px-2">
                                    <button onClick={startQuiz} className="btn-ghibli w-full bg-[#8baeb2] hover:bg-[#6c8f93] text-white font-bold py-4 shadow-lg text-xl transition-all">é–‹å§‹ä½œç­”</button>
                                    <button onClick={() => { setView('leaderboard'); fetchLeaderboard(); }} className="btn-ghibli w-full bg-white text-stone-500 border-2 border-stone-100 font-semibold py-4 hover:bg-stone-50 transition-all">è§€çœ‹æ’è¡Œæ¦œ</button>
                                </div>
                            </div>
                        )}

                        {view === 'quiz' && (
                            <div className="bg-white p-8 rounded-[30px] shadow-xl border-4 border-white fade-in">
                                <div className="flex justify-between items-center mb-10 text-stone-400 font-bold text-[10px] tracking-widest uppercase">
                                    <span>é€²åº¦ {currentIndex + 1} / 20</span>
                                    <div className="w-32 h-1.5 bg-stone-100 rounded-full overflow-hidden"><div className="h-full bg-[#8baeb2] transition-all duration-500" style={{ width: `${((currentIndex + 1) / 20) * 100}%` }}></div></div>
                                </div>
                                <h2 className="text-2xl font-bold mb-8 min-h-[5rem] leading-relaxed text-stone-800 text-left">{currentQuestions[currentIndex]?.q}</h2>
                                {quizFeedback && (
                                    <div key={feedbackKey} className="mb-6 p-3 bg-red-50 border border-red-100 rounded-xl text-red-500 text-center font-bold text-sm shake">
                                        {quizFeedback}
                                    </div>
                                )}
                                <div className="space-y-4 text-left">
                                    {currentQuestions[currentIndex]?.a.map((opt, i) => (
                                        <button key={i} onClick={() => handleAnswer(i)} className="w-full text-left p-6 border-2 border-stone-50 hover:border-[#8baeb2] hover:bg-[#8baeb2]/5 rounded-3xl flex items-center transition-all">
                                            <span className="flex-shrink-0 w-10 h-10 flex items-center justify-center bg-stone-50 rounded-full mr-4 text-xs font-bold border border-stone-100">{String.fromCharCode(65 + i)}</span>
                                            <span className="text-stone-700">{opt}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        {view === 'result' && (
                            <div className="space-y-6 fade-in flex flex-col items-center text-center">
                                <div className="certificate-preview-scroll">
                                    <div className="certificate-outer" ref={certificateRef}>
                                        <div className="certificate-container">
                                            <div className="watermark-overlay"></div>
                                            <div className="certificate-inner-border">
                                                <div style={{ position: 'absolute', top: '50px', left: '60px' }}>
                                                    <img src="IPæ¨™ç±¤.jpg" alt="Logo" className="w-20 h-auto border border-stone-200 shadow-sm" onError={(e) => { e.target.onerror = null; e.target.src='https://www.google.com/s2/favicons?domain=joption.tw&sz=64'; }} />
                                                </div>
                                                <div style={{ marginTop: '40px', marginBottom: '0px' }} className="text-center">
                                                    <h1 className="text-6xl font-black text-stone-800 tracking-[0.25em] no-wrap" style={{ lineHeight: '1.1' }}>çµæ¥­è­‰æ›¸</h1>
                                                    <div style={{ marginTop: '75px' }}> 
                                                        <p className="text-stone-400 text-2xl tracking-[0.4em] font-bold uppercase no-wrap font-sans">Chap 1 é¸æ“‡æ¬Šé‚è¼¯å…¥é–€</p>
                                                    </div>
                                                </div>
                                                <div style={{ marginBottom: '60px', marginTop: '20px' }} className="text-center">
                                                    <p className="text-stone-50 text-3xl italic tracking-[0.2em] font-serif">èŒ²è­‰æ˜</p>
                                                </div>
                                                <div style={{ marginBottom: '15px' }} className="text-center w-full">
                                                    <h2 className="text-5xl font-black text-stone-900 no-wrap tracking-widest">{playerName}</h2>
                                                </div>
                                                <div style={{ marginBottom: '40px' }} className="text-center">
                                                    <p className="text-stone-600 text-2xl tracking-widest font-serif">åƒèˆ‡éš¨å ‚æ¸¬é©—ï¼Œç²å¾—æˆç¸¾ï¼š</p>
                                                </div>
                                                <div style={{ marginBottom: '65px' }} className="flex items-center justify-center gap-36 w-full">
                                                    <div className="text-center">
                                                        <span className="text-lg text-stone-300 font-bold block mb-3 uppercase tracking-[0.3em] font-sans">åˆ†æ•¸</span>
                                                        <span className="text-8xl font-black text-amber-800 tabular-nums" style={{ lineHeight: '1' }}>{score}</span>
                                                    </div>
                                                    <div className="text-center">
                                                        <span className="text-lg text-stone-300 font-bold block mb-3 uppercase tracking-[0.3em] font-sans">æˆäºˆéšç´š</span>
                                                        <div className="flex flex-col items-center">
                                                            <span className="text-6xl mb-4">{getRankInfo(score).icon}</span>
                                                            <span className={`text-3xl font-black ${getRankInfo(score).color} no-wrap tracking-[0.2em]`}>{getRankInfo(score).title}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div style={{ marginBottom: '55px' }} className="max-w-xl mx-auto text-center px-10">
                                                    <p className="text-stone-400 text-xl leading-relaxed tracking-wider font-serif">
                                                        å…·å‚™åˆéšé¸æ“‡æ¬Šé¢¨éšªè­˜åˆ¥èˆ‡<br/>
                                                        åŸºæœ¬ç­–ç•¥é‹ç”¨èƒ½åŠ›ï¼Œç‰¹ç™¼æ­¤è­‰ã€‚
                                                    </p>
                                                </div>
                                                <div style={{ position: 'absolute', bottom: '15px', left: '30px', right: '30px' }} className="flex justify-between items-end">
                                                    <div className="text-left text-base text-stone-400 font-sans leading-relaxed uppercase tracking-tighter">
                                                        DATE: {new Date().toLocaleDateString('zh-TW')}<br/>
                                                        NO: JOPT-ID-{Math.floor(Date.now()/1000)}
                                                    </div>
                                                    <div className="relative flex items-center" style={{ transform: 'translate(-50px, -25px)' }}>
                                                        <span className="text-stone-900 text-4xl font-black italic no-wrap tracking-tighter">é™¢é•· æ­å¤§</span>
                                                        <div style={{ 
                                                            width: '110px', height: '110px', border: '5.5px solid rgba(220, 38, 38, 0.78)', 
                                                            borderRadius: '50%', position: 'absolute', top: '-55px', right: '-45px', 
                                                            display: 'flex', alignItems: 'center', justifyContent: 'center', 
                                                            transform: 'rotate(15deg)', pointerEvents: 'none'
                                                        }}>
                                                            <div className="text-red-600/95 font-black text-[27px] leading-[1.05] text-center font-sans">æ­å¤§<br/>é¸æ“‡æ¬Š</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <p className="text-stone-500 text-lg mt-1 font-bold tracking-widest bg-amber-50 px-6 py-2 rounded-full border border-amber-100 shadow-sm animate-pulse">
                                    æ‰‹æ©Ÿè«‹ç”¨æˆªåœ–æ–¹å¼ä¿å­˜
                                </p>

                                <div className="w-full max-w-lg grid grid-cols-1 gap-4 px-2 pt-2">
                                    <button onClick={() => { setView('leaderboard'); fetchLeaderboard(); }} className="btn-ghibli w-full bg-[#8baeb2] text-white py-4 rounded-full font-bold shadow-lg text-lg flex items-center justify-center gap-2 font-serif"><Trophy /> è§€çœ‹å³æ™‚æ’è¡Œæ¦œ</button>
                                    <div className="flex gap-4">
                                        <button onClick={saveAsImage} disabled={isSaving} className="btn-ghibli flex-1 bg-stone-900 text-white py-4 rounded-full font-bold shadow hover:bg-black transition-all text-base flex items-center justify-center gap-2 font-serif">
                                            {isSaving ? <Loader className="w-4 h-4 text-white" /> : <><Download className="w-4 h-4"/> ä¸‹è¼‰å­˜æª”</>}
                                        </button>
                                        <button onClick={() => setView('home')} className="btn-ghibli flex-1 bg-white text-stone-400 border-2 border-stone-100 py-4 rounded-full font-bold hover:bg-stone-50 transition-all text-base font-serif">è¿”å›æŒ‘æˆ°</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'leaderboard' && (
                            <div className="bg-white/95 backdrop-blur-md p-6 rounded-[30px] max-h-[85vh] flex flex-col shadow-2xl border-4 border-white fade-in mx-auto max-w-md text-center">
                                <div className="flex justify-between items-center mb-6 border-b border-stone-100 pb-4">
                                    <h2 className="text-xl font-bold text-stone-800 tracking-widest no-wrap font-serif">æ­å¤§é¸æ“‡æ¬Šæ¦œå–®</h2>
                                    <button onClick={() => setView('home')} className="p-2 text-stone-300 hover:text-stone-800 transition-colors"><Home /></button>
                                </div>
                                <div className="flex px-4 py-2 text-stone-400 text-[10px] font-bold border-b border-stone-100 mb-2 bg-stone-50/50 rounded-t-xl font-sans">
                                    <div className="w-[40%] text-left flex items-center gap-1 cursor-pointer" onClick={() => handleSort('name')}>å§“å {sortConfig.field === 'name' && (sortConfig.direction === 'desc' ? <ArrowDown /> : <ArrowUp />)}</div>
                                    <div className="w-[20%] text-center flex items-center justify-center gap-1 cursor-pointer" onClick={() => handleSort('score')}>åˆ†æ•¸ {sortConfig.field === 'score' && (sortConfig.direction === 'desc' ? <ArrowDown /> : <ArrowUp />)}</div>
                                    <div className="w-[40%] text-right flex items-center justify-end gap-1 cursor-pointer" onClick={() => handleSort('timestamp')}>æ—¥æœŸ {sortConfig.field === 'timestamp' && (sortConfig.direction === 'desc' ? <ArrowDown /> : <ArrowUp />)}</div>
                                </div>
                                <div className="overflow-y-auto flex-1 space-y-1 pr-1 scrollbar-hide text-left">
                                    {isLoadingLeaderboard ? (
                                        <div className="text-center py-24 text-stone-300 flex flex-col items-center gap-4"><Loader className="w-8 h-8 text-stone-300" /><p className="text-[10px] uppercase font-bold">æ•¸æ“šè®€å–ä¸­...</p></div>
                                    ) : sortedLeaderboard.length > 0 ? sortedLeaderboard.map((item, idx) => (
                                        <div key={idx} className="flex items-center p-3 bg-stone-50/50 rounded-[15px] hover:bg-white border border-transparent hover:border-stone-100 mb-1 font-sans">
                                            <div className="w-[40%] flex items-center gap-2 overflow-hidden">
                                                <span className={`flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center font-black text-[9px] ${item.score >= 100 ? 'bg-amber-400 text-white' : 'bg-stone-200 text-stone-400'}`}>
                                                    {sortConfig.field === 'score' && sortConfig.direction === 'desc' ? idx + 1 : 'â€¢'}
                                                </span>
                                                <div className="overflow-hidden">
                                                    <div className="font-bold text-stone-800 text-xs truncate">{item.name}</div>
                                                    <div className={`text-[7px] font-bold uppercase ${getRankInfo(item.score).color} truncate`}>{getRankInfo(item.score).title}</div>
                                                </div>
                                            </div>
                                            <div className="w-[20%] text-center"><span className="font-black text-stone-900 text-base">{item.score}</span></div>
                                            <div className="w-[40%] text-right text-[10px] text-stone-400 tabular-nums font-bold">{item.date}</div>
                                        </div>
                                    )) : (
                                        <div className="text-center py-24 text-stone-400 flex flex-col items-center gap-4"><Trophy /><p className="text-xs font-bold">ç›®å‰å°šç„¡æŒ‘æˆ°ç´€éŒ„</p></div>
                                    )}
                                </div>
                                <button onClick={() => setView('home')} className="mt-6 w-full bg-stone-50 text-stone-400 font-bold py-3 rounded-full hover:bg-stone-100 text-xs uppercase font-sans">é›¢é–‹æ¦œå–®</button>
                            </div>
                        )}

                        {savedImageUrl && (
                            <div className="modal-backdrop" onClick={() => setSavedImageUrl(null)}>
                                <div className="bg-white p-5 rounded-3xl max-w-sm w-full shadow-2xl relative" onClick={e => e.stopPropagation()}>
                                    <button onClick={() => setSavedImageUrl(null)} className="absolute -top-12 right-0 text-white flex items-center gap-1 font-bold">é—œé–‰ <X /></button>
                                    <div className="text-center mb-4 text-stone-600">
                                        <p className="font-bold text-amber-600 mb-1 italic text-lg tracking-widest">ğŸ‰ ç”ŸæˆæˆåŠŸï¼</p>
                                        <p className="text-base font-bold underline">æ‰‹æ©Ÿç”¨æˆ¶è«‹ã€Œé•·æŒ‰ä¸‹æ–¹åœ–ç‰‡ã€å„²å­˜</p>
                                        <p className="text-xs text-stone-400 mt-1 italic">è‹¥è¦–çª—ç©ºç™½è«‹ç¨å€™ 3 ç§’ï¼Œç³»çµ±æ­£åœ¨æ¸²æŸ“é«˜å“è³ªåœ–ç‰‡</p>
                                    </div>
                                    <div className="border-4 border-amber-50 rounded-xl overflow-hidden bg-white">
                                        <img src={savedImageUrl} alt="Certificate Image" className="saveable-image" />
                                    </div>
                                    <button onClick={() => setSavedImageUrl(null)} className="mt-6 w-full py-4 bg-[#8baeb2] text-white rounded-xl font-bold shadow-lg text-lg">å®Œæˆå­˜æª”ï¼Œè¿”å›æŒ‘æˆ°</button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>